const m={name:"paragraph",title:"Paragrafo",defaultVariant:"1",variants:[{value:"1",label:"Checkerboard A (testo a sinistra)"},{value:"2",label:"Checkerboard B (testo a destra)"}],fields:[{key:"pretitle",label:"Pretitle",input:"text",sanitize:"text",default:""},{key:"title",label:"Title",input:"text",sanitize:"text",default:""},{key:"text",label:"Text",input:"textarea",sanitize:"html",default:""}]},{registerBlockType:C}=wp.blocks,{InspectorControls:A,useBlockProps:v,MediaUpload:H,MediaUploadCheck:X,InnerBlocks:k}=wp.blockEditor,{PanelBody:V,TextControl:_,TextareaControl:q,Button:M,SelectControl:y}=wp.components,{createElement:o,useEffect:O}=wp.element,{__:r}=wp.i18n,{subscribe:ee,select:Y,dispatch:te}=wp.data,le=wp.serverSideRender,W="_logical_content_json",Q="2.0",j="3.0",N="logical-theme/paragraph",P="logical-theme/layout",I="logical-theme/row",w="logical-theme/column",R="logical-theme/pretitle",K="logical-theme/title",U="logical-theme/text",$="logical-theme/image",D="logical-theme/button",ae=[R,K,U,$,D];function f(t){return`${t}_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`}function l(t){return typeof t=="string"?t:""}function d(t){const e=Number.parseInt(t,10);return Number.isNaN(e)?12:Math.max(1,Math.min(12,e))}function ne(t){if(!t||typeof t!="string")return null;try{const e=JSON.parse(t);if(!e||typeof e!="object")return null;if(e.version===Q&&Array.isArray(e.sections)||e.version===j&&Array.isArray(e.layout))return e}catch{return null}return null}function T(t,e,a){e({data:{...t.data||{},...a}})}function F(t,e,a){e({settings:{...t.settings||{},...a}})}function Z(){const t=Y("core/block-editor"),e=t!=null&&t.getSettings?t.getSettings():null,s=(Array.isArray(e==null?void 0:e.colors)?e.colors:[]).map(n=>{if(!n||typeof n!="object")return null;const i=l(n.slug);if(!i)return null;const g=l(n.name)||i;return{value:i,label:g}}).filter(Boolean);return[{value:"",label:r("Default","wp-logical-theme")},...s]}function oe(t,e){const a=t.data||{},s=t.settings||{},n=Array.isArray(m==null?void 0:m.fields)?m.fields:[],i=Array.isArray(m==null?void 0:m.variants)?m.variants:[],g=m.defaultVariant,h=[],b=i.map(c=>{if(c&&typeof c=="object"){const p=typeof c.value=="string"?c.value:"",x=typeof c.label=="string"&&c.label!==""?c.label:p;return p?{value:p,label:x}:null}return typeof c=="string"&&c!==""?{value:c,label:c}:null}).filter(Boolean);b.length>0&&h.push(o(y,{key:"paragraph-variant",label:r("Variant","wp-logical-theme"),value:l(s.variant||g),options:b,onChange:c=>F(t,e,{variant:c})})),h.push(o(y,{key:"paragraph-surface-color",label:r("Section background","wp-logical-theme"),value:l(s.backgroundColor),options:Z(),onChange:c=>F(t,e,{backgroundColor:c})})),n.forEach(c=>{if(!c||typeof c!="object"||typeof c.key!="string")return;const p=c.key,x=typeof c.label=="string"&&c.label!==""?c.label:p,E=c.input==="textarea"?"textarea":"text",S=l(a[p]??c.default??"");if(E==="textarea"){h.push(o(q,{key:p,label:r(x,"wp-logical-theme"),value:S,onChange:B=>T(t,e,{[p]:B})}));return}h.push(o(_,{key:p,label:r(x,"wp-logical-theme"),value:S,onChange:B=>T(t,e,{[p]:B})}))});const u=a.image&&typeof a.image=="object"?a.image:{};return h.push(o(X,{key:"paragraph-image-check"},o(H,{onSelect:c=>{const p={id:(c==null?void 0:c.id)||0,src:(c==null?void 0:c.url)||"",alt:(c==null?void 0:c.alt)||(c==null?void 0:c.title)||""};T(t,e,{image:p})},allowedTypes:["image"],value:u.id||0,render:({open:c})=>o(M,{variant:"secondary",onClick:c},u!=null&&u.src?r("Change image","wp-logical-theme"):r("Select image","wp-logical-theme"))}))),u!=null&&u.src&&(h.push(o(_,{key:"paragraph-image-alt",label:r("Image Alt","wp-logical-theme"),value:l(u.alt),onChange:c=>T(t,e,{image:{...u,alt:c}})})),h.push(o(M,{key:"paragraph-image-remove",variant:"secondary",isDestructive:!0,onClick:()=>T(t,e,{image:{id:0,src:"",alt:""}})},r("Remove image","wp-logical-theme")))),h}function re(){C(R,{apiVersion:2,title:r("Pretitle","wp-logical-theme"),icon:"editor-kitchensink",category:"widgets",parent:[w],attributes:{text:{type:"string",default:""}},supports:{html:!1,reusable:!1},edit:function({attributes:e,setAttributes:a}){const s=v({className:"logical-layout-mini-pretitle"});return o("div",s,o(_,{label:r("Pretitle","wp-logical-theme"),value:l(e.text),onChange:n=>a({text:n})}),o("span",{className:"text-sm font-semibold uppercase logical-color-eyebrow"},l(e.text)||r("Pretitle","wp-logical-theme")))},save:function({attributes:e}){return o("span",{className:"logical-layout-pretitle text-sm font-semibold uppercase logical-color-eyebrow"},l(e.text))}}),C(K,{apiVersion:2,title:r("Title","wp-logical-theme"),icon:"heading",category:"widgets",parent:[w],attributes:{text:{type:"string",default:""},level:{type:"string",default:"h2"}},supports:{html:!1,reusable:!1},edit:function({attributes:e,setAttributes:a}){const s=["h1","h2","h3","h4","h5","h6"].includes(l(e.level))?l(e.level):"h2",n=v({className:"logical-layout-mini-title"});return o("div",n,o(y,{label:r("Level","wp-logical-theme"),value:s,options:["h1","h2","h3","h4","h5","h6"].map(i=>({value:i,label:i.toUpperCase()})),onChange:i=>a({level:i})}),o(_,{label:r("Title","wp-logical-theme"),value:l(e.text),onChange:i=>a({text:i})}),o(s,{className:"text-3xl font-bold logical-color-heading"},l(e.text)||r("Title","wp-logical-theme")))},save:function({attributes:e}){const a=["h1","h2","h3","h4","h5","h6"].includes(l(e.level))?l(e.level):"h2";return o(a,{className:"logical-layout-title text-3xl font-bold logical-color-heading"},l(e.text))}}),C(U,{apiVersion:2,title:r("Text","wp-logical-theme"),icon:"text",category:"widgets",parent:[w],attributes:{text:{type:"string",default:""}},supports:{html:!1,reusable:!1},edit:function({attributes:e,setAttributes:a}){const s=v({className:"logical-layout-mini-text"});return o("div",s,o(q,{label:r("Text","wp-logical-theme"),value:l(e.text),onChange:n=>a({text:n})}))},save:function({attributes:e}){return o("div",{className:"logical-layout-text logical-color-body"},l(e.text))}}),C($,{apiVersion:2,title:r("Image","wp-logical-theme"),icon:"format-image",category:"widgets",parent:[w],attributes:{id:{type:"number",default:0},src:{type:"string",default:""},alt:{type:"string",default:""}},supports:{html:!1,reusable:!1},edit:function({attributes:e,setAttributes:a}){const s=v({className:"logical-layout-mini-image"});return o("div",s,o(X,null,o(H,{onSelect:n=>a({id:(n==null?void 0:n.id)||0,src:(n==null?void 0:n.url)||"",alt:(n==null?void 0:n.alt)||(n==null?void 0:n.title)||""}),allowedTypes:["image"],value:e.id||0,render:({open:n})=>o(M,{variant:"secondary",onClick:n},e.src?r("Change image","wp-logical-theme"):r("Select image","wp-logical-theme"))})),e.src?o("img",{src:e.src,alt:l(e.alt),className:"h-auto w-full rounded-lg object-cover"}):null,e.src?o(_,{label:r("Image alt","wp-logical-theme"),value:l(e.alt),onChange:n=>a({alt:n})}):null)},save:function({attributes:e}){return l(e.src)?o("img",{src:l(e.src),alt:l(e.alt),className:"logical-layout-image h-auto w-full rounded-lg object-cover"}):null}}),C(D,{apiVersion:2,title:r("Button","wp-logical-theme"),icon:"button",category:"widgets",parent:[w],attributes:{label:{type:"string",default:""},url:{type:"string",default:""},variant:{type:"string",default:"primary"},target:{type:"string",default:"_self"}},supports:{html:!1,reusable:!1},edit:function({attributes:e,setAttributes:a}){const s=["primary","secondary","outline","link"].includes(l(e.variant))?l(e.variant):"primary",n=l(e.target)==="_blank"?"_blank":"_self",i=v({className:"logical-layout-mini-button"});return o("div",i,o(_,{label:r("Button label","wp-logical-theme"),value:l(e.label),onChange:g=>a({label:g})}),o(_,{label:r("Button URL","wp-logical-theme"),value:l(e.url),onChange:g=>a({url:g})}),o(y,{label:r("Variant","wp-logical-theme"),value:s,options:[{value:"primary",label:r("Primary","wp-logical-theme")},{value:"secondary",label:r("Secondary","wp-logical-theme")},{value:"outline",label:r("Outline","wp-logical-theme")},{value:"link",label:r("Link","wp-logical-theme")}],onChange:g=>a({variant:g})}),o(y,{label:r("Target","wp-logical-theme"),value:n,options:[{value:"_self",label:r("Same tab","wp-logical-theme")},{value:"_blank",label:r("New tab","wp-logical-theme")}],onChange:g=>a({target:g==="_blank"?"_blank":"_self"})}))},save:function({attributes:e}){const a=l(e.label),s=l(e.url);if(!a||!s)return null;const n=["primary","secondary","outline","link"].includes(l(e.variant))?l(e.variant):"primary",i={primary:"border-primary bg-primary text-light",secondary:"border-secondary bg-secondary text-light",outline:"border-primary bg-transparent text-primary",link:"border-transparent bg-transparent p-0 text-primary underline underline-offset-4"},g=l(e.target)==="_blank"?"_blank":"_self";return o("a",{href:s,target:g==="_blank"?"_blank":void 0,rel:g==="_blank"?"noopener noreferrer":void 0,className:`logical-layout-button inline-flex items-center justify-center rounded-lg border px-5 py-3 text-sm font-semibold ${i[n]}`},a)}})}function ie(t){var e,a,s,n,i,g,h,b,u,c,p,x,E,S,B,J;if(!t||typeof t!="object"||typeof t.name!="string")return null;if(t.name===N)return{id:l((e=t.attributes)==null?void 0:e.sectionId)||f("item"),type:"paragraph",data:(a=t.attributes)!=null&&a.data&&typeof t.attributes.data=="object"?t.attributes.data:{},settings:(s=t.attributes)!=null&&s.settings&&typeof t.attributes.settings=="object"?t.attributes.settings:{}};if(t.name==="core/embed")return{id:f("item"),type:"embed",data:{url:l((n=t.attributes)==null?void 0:n.url),provider:l((i=t.attributes)==null?void 0:i.providerNameSlug)},settings:{}};if(t.name===R)return{id:f("item"),type:"pretitle",data:{text:l((g=t.attributes)==null?void 0:g.text)},settings:{}};if(t.name===K){const L=["h1","h2","h3","h4","h5","h6"].includes(l((h=t.attributes)==null?void 0:h.level))?l(t.attributes.level):"h2";return{id:f("item"),type:"title",data:{text:l((b=t.attributes)==null?void 0:b.text),level:L},settings:{}}}if(t.name===U)return{id:f("item"),type:"text",data:{text:l((u=t.attributes)==null?void 0:u.text)},settings:{}};if(t.name===$)return{id:f("item"),type:"image",data:{id:Number.parseInt(((c=t.attributes)==null?void 0:c.id)||0,10)||0,src:l((p=t.attributes)==null?void 0:p.src),alt:l((x=t.attributes)==null?void 0:x.alt)},settings:{}};if(t.name===D){const L=["primary","secondary","outline","link"].includes(l((E=t.attributes)==null?void 0:E.variant))?l(t.attributes.variant):"primary",z=l((S=t.attributes)==null?void 0:S.target)==="_blank"?"_blank":"_self";return{id:f("item"),type:"button",data:{label:l((B=t.attributes)==null?void 0:B.label),url:l((J=t.attributes)==null?void 0:J.url),variant:L,target:z,rel:z==="_blank"?"noopener noreferrer":""},settings:{}}}return null}function ce(t){const e=Array.isArray(t)?t.find(a=>(a==null?void 0:a.name)===P):null;return!e||!Array.isArray(e.innerBlocks)?[]:e.innerBlocks.filter(a=>(a==null?void 0:a.name)===I).map(a=>{const s=a.attributes&&typeof a.attributes=="object"?a.attributes:{};return{id:l(s.rowId)||f("row"),type:"row",settings:{container:["default","wide","full"].includes(l(s.container))?l(s.container):"default",gap:["none","sm","md","lg"].includes(l(s.gap))?l(s.gap):"md",alignY:["start","center","end","stretch"].includes(l(s.alignY))?l(s.alignY):"stretch",backgroundColor:l(s.backgroundColor)},columns:(Array.isArray(a.innerBlocks)?a.innerBlocks:[]).filter(n=>(n==null?void 0:n.name)===w).map(n=>{const i=n.attributes&&typeof n.attributes=="object"?n.attributes:{};return{id:l(i.columnId)||f("col"),type:"column",settings:{desktop:d(i.desktop),tablet:d(i.tablet),mobile:d(i.mobile),alignY:["start","center","end","stretch"].includes(l(i.alignY))?l(i.alignY):"stretch"},items:(Array.isArray(n.innerBlocks)?n.innerBlocks:[]).map(g=>ie(g)).filter(Boolean)}})}})}C(N,{apiVersion:2,title:r(m==null?void 0:m.title,"wp-logical-theme"),icon:"layout",category:"widgets",attributes:{sectionId:{type:"string",default:""},sectionType:{type:"string",default:"paragraph"},data:{type:"object",default:{}},settings:{type:"object",default:{}}},supports:{html:!1},edit:function({attributes:e,setAttributes:a}){const s=v({className:"wp-block-logical-theme-paragraph"});O(()=>{e.sectionId||a({sectionId:f("sec")})},[e.sectionId,a]),O(()=>{e.sectionType!=="paragraph"&&a({sectionType:"paragraph"})},[e.sectionType,a]);const n=oe(e,a);return o("div",s,o(A,null,o(V,{title:r("Content","wp-logical-theme"),initialOpen:!0},...n)),o("strong",null,r(m==null?void 0:m.title,"wp-logical-theme")),o(le,{key:`${N}:${e.sectionId||"new"}:${JSON.stringify(e.data||{})}:${JSON.stringify(e.settings||{})}`,block:N,attributes:e}))},save:function(){return null}});C(w,{apiVersion:2,title:r("Column","wp-logical-theme"),icon:"columns",category:"widgets",parent:[I],attributes:{columnId:{type:"string",default:""},desktop:{type:"number",default:12},tablet:{type:"number",default:12},mobile:{type:"number",default:12},alignY:{type:"string",default:"stretch"}},supports:{html:!1,reusable:!1},edit:function({attributes:e,setAttributes:a}){O(()=>{e.columnId||a({columnId:f("col")})},[e.columnId,a]);const s=v({className:"logical-layout-col",style:{"--logical-col-mobile":d(e.mobile),"--logical-col-tablet":d(e.tablet),"--logical-col-desktop":d(e.desktop),"--logical-col-align":["start","center","end","stretch"].includes(l(e.alignY))?l(e.alignY):"stretch"}});return o("div",s,o(A,null,o(V,{title:r("Column Settings","wp-logical-theme"),initialOpen:!0},o(y,{label:r("Desktop span","wp-logical-theme"),value:String(d(e.desktop)),options:Array.from({length:12}).map((n,i)=>({value:String(i+1),label:String(i+1)})),onChange:n=>a({desktop:d(n)})}),o(y,{label:r("Tablet span","wp-logical-theme"),value:String(d(e.tablet)),options:Array.from({length:12}).map((n,i)=>({value:String(i+1),label:String(i+1)})),onChange:n=>a({tablet:d(n)})}),o(y,{label:r("Mobile span","wp-logical-theme"),value:String(d(e.mobile)),options:Array.from({length:12}).map((n,i)=>({value:String(i+1),label:String(i+1)})),onChange:n=>a({mobile:d(n)})}),o(y,{label:r("Vertical align","wp-logical-theme"),value:["start","center","end","stretch"].includes(l(e.alignY))?l(e.alignY):"stretch",options:[{value:"stretch",label:r("Stretch","wp-logical-theme")},{value:"start",label:r("Top","wp-logical-theme")},{value:"center",label:r("Center","wp-logical-theme")},{value:"end",label:r("Bottom","wp-logical-theme")}],onChange:n=>a({alignY:n})}))),o(k,{allowedBlocks:[N,"core/embed",...ae],orientation:"vertical",renderAppender:k.ButtonBlockAppender}))},save:function({attributes:e}){const a=v.save({className:"logical-layout-col",style:{"--logical-col-mobile":d(e.mobile),"--logical-col-tablet":d(e.tablet),"--logical-col-desktop":d(e.desktop),"--logical-col-align":["start","center","end","stretch"].includes(l(e.alignY))?l(e.alignY):"stretch"}});return o("div",a,o(k.Content))}});re();C(I,{apiVersion:2,title:r("Row","wp-logical-theme"),icon:"menu-alt3",category:"widgets",parent:[P],attributes:{rowId:{type:"string",default:""},container:{type:"string",default:"default"},gap:{type:"string",default:"md"},alignY:{type:"string",default:"stretch"},backgroundColor:{type:"string",default:""}},supports:{html:!1,reusable:!1},edit:function({attributes:e,setAttributes:a}){O(()=>{e.rowId||a({rowId:f("row")})},[e.rowId,a]);const s={none:"0",sm:"0.75rem",md:"1.25rem",lg:"2rem"},n=v({className:"logical-layout-row logical-theme-color-surface",style:{"--logical-row-gap":s[l(e.gap)]||s.md,"--logical-row-align":["start","center","end","stretch"].includes(l(e.alignY))?l(e.alignY):"stretch"},"data-surface-color":l(e.backgroundColor)});return o("div",n,o(A,null,o(V,{title:r("Row Settings","wp-logical-theme"),initialOpen:!0},o(y,{label:r("Container","wp-logical-theme"),value:["default","wide","full"].includes(l(e.container))?l(e.container):"default",options:[{value:"default",label:r("Default","wp-logical-theme")},{value:"wide",label:r("Wide","wp-logical-theme")},{value:"full",label:r("Full","wp-logical-theme")}],onChange:i=>a({container:i})}),o(y,{label:r("Gap","wp-logical-theme"),value:["none","sm","md","lg"].includes(l(e.gap))?l(e.gap):"md",options:[{value:"none",label:r("None","wp-logical-theme")},{value:"sm",label:r("Small","wp-logical-theme")},{value:"md",label:r("Medium","wp-logical-theme")},{value:"lg",label:r("Large","wp-logical-theme")}],onChange:i=>a({gap:i})}),o(y,{label:r("Vertical align","wp-logical-theme"),value:["start","center","end","stretch"].includes(l(e.alignY))?l(e.alignY):"stretch",options:[{value:"stretch",label:r("Stretch","wp-logical-theme")},{value:"start",label:r("Top","wp-logical-theme")},{value:"center",label:r("Center","wp-logical-theme")},{value:"end",label:r("Bottom","wp-logical-theme")}],onChange:i=>a({alignY:i})}),o(y,{label:r("Background","wp-logical-theme"),value:l(e.backgroundColor),options:Z(),onChange:i=>a({backgroundColor:i})}))),o(k,{allowedBlocks:[w],orientation:"horizontal",template:[[w]],renderAppender:k.ButtonBlockAppender}))},save:function({attributes:e}){const a={none:"0",sm:"0.75rem",md:"1.25rem",lg:"2rem"},s=v.save({className:"logical-layout-row logical-theme-color-surface",style:{"--logical-row-gap":a[l(e.gap)]||a.md,"--logical-row-align":["start","center","end","stretch"].includes(l(e.alignY))?l(e.alignY):"stretch"},"data-surface-color":l(e.backgroundColor)}),n=["default","wide","full"].includes(l(e.container))?l(e.container):"default";return o("div",{className:n==="full"?"logical-layout-container-full":n==="wide"?"container logical-layout-container-wide":"container"},o("div",s,o(k.Content)))}});C(P,{apiVersion:2,title:r("Layout","wp-logical-theme"),icon:"screenoptions",category:"widgets",attributes:{layoutVersion:{type:"string",default:j}},supports:{html:!1},edit:function(){const e=v({className:"logical-layout-block"});return o("section",e,o(k,{allowedBlocks:[I],template:[[I,{},[[w]]]],renderAppender:k.ButtonBlockAppender}))},save:function(){return o("section",{className:"logical-layout-block"},o(k.Content))}});let G=null;ee(()=>{const t=Y("core/editor");if(!t||t.getCurrentPostType()!=="page")return;const a=Y("core/block-editor");if(!a)return;const s=a.getBlocks(),n=s.some(c=>c.name===P);let i;if(n)i={version:j,layout:ce(s)};else{const c=s.filter(p=>p.name===N);i={version:Q,sections:c.map(p=>({id:p.attributes.sectionId||f("sec"),type:"paragraph",data:p.attributes.data||{},settings:p.attributes.settings||{}}))}}const g=t.getEditedPostAttribute("meta")||{},h=ne(g[W]);if(h&&JSON.stringify(h)===JSON.stringify(i))return;const b=JSON.stringify(i);if(b===G)return;const u=te("core/editor");u&&(u.editPost({meta:{...g,[W]:b}}),G=b)});
