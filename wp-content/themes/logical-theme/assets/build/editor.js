const _="paragraph",N="Paragrafo",P="1",B=[{value:"1",label:"Checkerboard A (testo a sinistra)"},{value:"2",label:"Checkerboard B (testo a destra)"}],J=[{key:"pretitle",label:"Pretitle",input:"text",sanitize:"text",default:""},{key:"title",label:"Title",input:"text",sanitize:"text",default:""},{key:"text",label:"Text",input:"textarea",sanitize:"html",default:""}],a={name:_,title:N,defaultVariant:P,variants:B,fields:J},{registerBlockType:$}=wp.blocks,{InspectorControls:j,useBlockProps:M,MediaUpload:V,MediaUploadCheck:z}=wp.blockEditor,{PanelBody:D,TextControl:S,TextareaControl:R,Button:T,SelectControl:K}=wp.components,{createElement:s,useEffect:b}=wp.element,{__:i}=wp.i18n,{subscribe:A,select:x,dispatch:L}=wp.data,U=wp.serverSideRender,I="_logical_content_json",u="2.0",v="logical-theme/paragraph";function Y(){return`sec_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`}function q(n){if(!n||typeof n!="string")return{version:u,sections:[]};try{const t=JSON.parse(n);if(t&&t.version===u&&Array.isArray(t.sections))return t}catch{return{version:u,sections:[]}}return{version:u,sections:[]}}function w(n){return typeof n=="string"?n:""}function f(n,t,o){t({data:{...n.data||{},...o}})}function F(n,t,o){t({settings:{...n.settings||{},...o}})}function G(n,t){const o=n.data||{},y=n.settings||{},p=Array.isArray(a==null?void 0:a.fields)?a.fields:[],d=Array.isArray(a==null?void 0:a.variants)?a.variants:[],h=a.defaultVariant,c=[],g=d.map(e=>{if(e&&typeof e=="object"){const r=typeof e.value=="string"?e.value:"",k=typeof e.label=="string"&&e.label!==""?e.label:r;return r?{value:r,label:k}:null}return typeof e=="string"&&e!==""?{value:e,label:e}:null}).filter(Boolean);g.length>0&&c.push(s(K,{key:"paragraph-variant",label:i("Variant","wp-logical-theme"),value:w(y.variant||h),options:g,onChange:e=>F(n,t,{variant:e})})),p.forEach(e=>{if(!e||typeof e!="object"||typeof e.key!="string")return;const r=e.key,k=typeof e.label=="string"&&e.label!==""?e.label:r,O=e.input==="textarea"?"textarea":"text",C=w(o[r]??e.default??"");if(O==="textarea"){c.push(s(R,{key:r,label:i(k,"wp-logical-theme"),value:C,onChange:m=>f(n,t,{[r]:m})}));return}c.push(s(S,{key:r,label:i(k,"wp-logical-theme"),value:C,onChange:m=>f(n,t,{[r]:m})}))});const l=o.image&&typeof o.image=="object"?o.image:{};return c.push(s(z,{key:"paragraph-image-check"},s(V,{onSelect:e=>{const r={id:(e==null?void 0:e.id)||0,src:(e==null?void 0:e.url)||"",alt:(e==null?void 0:e.alt)||(e==null?void 0:e.title)||""};f(n,t,{image:r})},allowedTypes:["image"],value:l.id||0,render:({open:e})=>s(T,{variant:"secondary",onClick:e},l!=null&&l.src?i("Change image","wp-logical-theme"):i("Select image","wp-logical-theme"))}))),l!=null&&l.src&&(c.push(s(S,{key:"paragraph-image-alt",label:i("Image Alt","wp-logical-theme"),value:w(l.alt),onChange:e=>f(n,t,{image:{...l,alt:e}})})),c.push(s(T,{key:"paragraph-image-remove",variant:"secondary",isDestructive:!0,onClick:()=>f(n,t,{image:{id:0,src:"",alt:""}})},i("Remove image","wp-logical-theme")))),c}$(v,{apiVersion:2,title:i(a==null?void 0:a.title,"wp-logical-theme"),icon:"layout",category:"widgets",attributes:{sectionId:{type:"string",default:""},sectionType:{type:"string",default:"paragraph"},data:{type:"object",default:{}},settings:{type:"object",default:{}}},supports:{html:!1},edit:function({attributes:t,setAttributes:o}){const y=M({className:"wp-block-logical-theme-paragraph"});b(()=>{t.sectionId||o({sectionId:Y()})},[t.sectionId,o]),b(()=>{t.sectionType!=="paragraph"&&o({sectionType:"paragraph"})},[t.sectionType,o]);const p=G(t,o);return s("div",y,s(j,null,s(D,{title:i("Content","wp-logical-theme"),initialOpen:!0},...p)),s("strong",null,i(a==null?void 0:a.title,"wp-logical-theme")),s(U,{key:`${v}:${t.sectionId||"new"}:${JSON.stringify(t.data||{})}:${JSON.stringify(t.settings||{})}`,block:v,attributes:t}))},save:function(){return null}});let E=null;A(()=>{const n=x("core/editor");if(!n||n.getCurrentPostType()!=="page")return;const o=x("core/block-editor");if(!o)return;const p=o.getBlocks().filter(e=>e.name===v).map(e=>({id:e.attributes.sectionId||`sec_${e.clientId}`,type:"paragraph",data:e.attributes.data||{},settings:e.attributes.settings||{}})),d=n.getEditedPostAttribute("meta")||{},h=q(d[I]),c={version:u,sections:p};if(h.version===u&&JSON.stringify(h.sections)===JSON.stringify(p))return;const g=JSON.stringify(c);if(g===E)return;const l=L("core/editor");l&&(l.editPost({meta:{...d,[I]:g}}),E=g)});
