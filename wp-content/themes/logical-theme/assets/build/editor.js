const B="paragraph",N="Paragrafo",j="1",J=[{value:"1",label:"Checkerboard A (testo a sinistra)"},{value:"2",label:"Checkerboard B (testo a destra)"}],$=[{key:"pretitle",label:"Pretitle",input:"text",sanitize:"text",default:""},{key:"title",label:"Title",input:"text",sanitize:"text",default:""},{key:"text",label:"Text",input:"textarea",sanitize:"html",default:""}],l={name:B,title:N,defaultVariant:j,variants:J,fields:$},{registerBlockType:M}=wp.blocks,{InspectorControls:V,useBlockProps:z,MediaUpload:D,MediaUploadCheck:R}=wp.blockEditor,{PanelBody:A,TextControl:S,TextareaControl:K,Button:T,SelectControl:x}=wp.components,{createElement:a,useEffect:I}=wp.element,{__:c}=wp.i18n,{subscribe:L,select:C,dispatch:U}=wp.data,Y=wp.serverSideRender,O="_logical_content_json",d="2.0",m="logical-theme/paragraph";function q(){return`sec_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`}function F(n){if(!n||typeof n!="string")return{version:d,sections:[]};try{const t=JSON.parse(n);if(t&&t.version===d&&Array.isArray(t.sections))return t}catch{return{version:d,sections:[]}}return{version:d,sections:[]}}function h(n){return typeof n=="string"?n:""}function k(n,t,o){t({data:{...n.data||{},...o}})}function E(n,t,o){t({settings:{...n.settings||{},...o}})}function G(){const n=C("core/block-editor"),t=n!=null&&n.getSettings?n.getSettings():null,u=(Array.isArray(t==null?void 0:t.colors)?t.colors:[]).map(i=>{if(!i||typeof i!="object")return null;const g=h(i.slug);if(!g)return null;const f=h(i.name)||g;return{value:g,label:f}}).filter(Boolean);return[{value:"",label:c("Default","wp-logical-theme")},...u]}function H(n,t){const o=n.data||{},u=n.settings||{},i=Array.isArray(l==null?void 0:l.fields)?l.fields:[],g=Array.isArray(l==null?void 0:l.variants)?l.variants:[],f=l.defaultVariant,p=[],y=g.map(e=>{if(e&&typeof e=="object"){const r=typeof e.value=="string"?e.value:"",v=typeof e.label=="string"&&e.label!==""?e.label:r;return r?{value:r,label:v}:null}return typeof e=="string"&&e!==""?{value:e,label:e}:null}).filter(Boolean);y.length>0&&p.push(a(x,{key:"paragraph-variant",label:c("Variant","wp-logical-theme"),value:h(u.variant||f),options:y,onChange:e=>E(n,t,{variant:e})})),p.push(a(x,{key:"paragraph-surface-color",label:c("Section background","wp-logical-theme"),value:h(u.backgroundColor),options:G(),onChange:e=>E(n,t,{backgroundColor:e})})),i.forEach(e=>{if(!e||typeof e!="object"||typeof e.key!="string")return;const r=e.key,v=typeof e.label=="string"&&e.label!==""?e.label:r,_=e.input==="textarea"?"textarea":"text",b=h(o[r]??e.default??"");if(_==="textarea"){p.push(a(K,{key:r,label:c(v,"wp-logical-theme"),value:b,onChange:w=>k(n,t,{[r]:w})}));return}p.push(a(S,{key:r,label:c(v,"wp-logical-theme"),value:b,onChange:w=>k(n,t,{[r]:w})}))});const s=o.image&&typeof o.image=="object"?o.image:{};return p.push(a(R,{key:"paragraph-image-check"},a(D,{onSelect:e=>{const r={id:(e==null?void 0:e.id)||0,src:(e==null?void 0:e.url)||"",alt:(e==null?void 0:e.alt)||(e==null?void 0:e.title)||""};k(n,t,{image:r})},allowedTypes:["image"],value:s.id||0,render:({open:e})=>a(T,{variant:"secondary",onClick:e},s!=null&&s.src?c("Change image","wp-logical-theme"):c("Select image","wp-logical-theme"))}))),s!=null&&s.src&&(p.push(a(S,{key:"paragraph-image-alt",label:c("Image Alt","wp-logical-theme"),value:h(s.alt),onChange:e=>k(n,t,{image:{...s,alt:e}})})),p.push(a(T,{key:"paragraph-image-remove",variant:"secondary",isDestructive:!0,onClick:()=>k(n,t,{image:{id:0,src:"",alt:""}})},c("Remove image","wp-logical-theme")))),p}M(m,{apiVersion:2,title:c(l==null?void 0:l.title,"wp-logical-theme"),icon:"layout",category:"widgets",attributes:{sectionId:{type:"string",default:""},sectionType:{type:"string",default:"paragraph"},data:{type:"object",default:{}},settings:{type:"object",default:{}}},supports:{html:!1},edit:function({attributes:t,setAttributes:o}){const u=z({className:"wp-block-logical-theme-paragraph"});I(()=>{t.sectionId||o({sectionId:q()})},[t.sectionId,o]),I(()=>{t.sectionType!=="paragraph"&&o({sectionType:"paragraph"})},[t.sectionType,o]);const i=H(t,o);return a("div",u,a(V,null,a(A,{title:c("Content","wp-logical-theme"),initialOpen:!0},...i)),a("strong",null,c(l==null?void 0:l.title,"wp-logical-theme")),a(Y,{key:`${m}:${t.sectionId||"new"}:${JSON.stringify(t.data||{})}:${JSON.stringify(t.settings||{})}`,block:m,attributes:t}))},save:function(){return null}});let P=null;L(()=>{const n=C("core/editor");if(!n||n.getCurrentPostType()!=="page")return;const o=C("core/block-editor");if(!o)return;const i=o.getBlocks().filter(e=>e.name===m).map(e=>({id:e.attributes.sectionId||`sec_${e.clientId}`,type:"paragraph",data:e.attributes.data||{},settings:e.attributes.settings||{}})),g=n.getEditedPostAttribute("meta")||{},f=F(g[O]),p={version:d,sections:i};if(f.version===d&&JSON.stringify(f.sections)===JSON.stringify(i))return;const y=JSON.stringify(p);if(y===P)return;const s=U("core/editor");s&&(s.editPost({meta:{...g,[O]:y}}),P=y)});
